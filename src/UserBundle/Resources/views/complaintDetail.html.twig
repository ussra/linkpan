{% extends "UserBundle::userbase.html.twig" %}


{% block style %}
    <link rel="stylesheet" href={{ asset('Userscripts/css/Detail.css') }}>
{% endblock %}


{% block Title %}
    Complaint Detail
{% endblock %}

{% block pageContent %}
    {% set complaint = app.session.get('complaint_detail') %}
    <div class="x_panel" style="margin-top: 50px">
        <div class="container" >
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <!--*****************************-->
                    <div class="my-list">
                        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                            <h3 id="bigtitle">{{ complaint.title }} <small>- to complaint {{ complaint.userToComplaint.firstname }} {{ complaint.userToComplaint.lastname }}</small></h3>
                            <div id="Detail">
                                <small><strong>Created By : {{ complaint.user.firstname }} {{ complaint.user.lastname }}</strong></small>
                                <br>
                                {{ complaint.description }}
                                {% if complaint.file is not null %}
                                    <br> <small>File : <strong><a href="{{ asset('attachements/fcc/') }}{{ complaint.file }}">{{ complaint.file }}</a></strong></small>
                                {% endif %}
                            </div>
                        </div>
                        <!--*****************************-->
                    </div>

                </div>
                <!--*******2******-->
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">

                        <div> <!-- row 2-->
                            <div class="row bootstrap snippets">
                                <div class="col-md-12">
                                    <div class="comment-wrapper">
                                        <div class="panel panel-info">
                                            <div class="panel-heading">
                                                <h4>complaints</h4>
                                            </div>
                                            <!-- set comments -->
                                            {% set complaint_reviews = app.session.get('complaint_reviews') %}
                                            <div class="panel-body">
                                                <form>
                                                    <textarea class="form-control" placeholder="write a comment..." rows="3" style="resize:none" id="complaintcomment"></textarea>
                                                    <a><button type="button" class="btn btn-info btn-xs pull-right" onclick="commentComplaint({{ complaint.id }})"><h5>Comment</h5></button></a>
                                                </form>
                                                <div class="clearfix"></div>
                                                <hr>

                                                <ul class="media-list" id="complaint_comments_list">
                                                    {% for comment in complaint_reviews %}
                                                        <li class="media">
                                                            <a href="#" class="pull-left">
                                                                {% if comment.user.image is null  %}{% set image = 'default.png' %} {% else %} {% set image = comment.user.image %}{% endif %}
                                                                <img src="{{ asset('images/profile/') }}{{ image }}" class="img-circle">
                                                            </a>
                                                            <div class="media-body">
                                                                <div class="names">
                                                                    {{ comment.user.firstname }} {{ comment.user.lastname }}
                                                                </div>

                                                                <p>
                                                                    {{ comment.review }}
                                                                </p>
                                                            </div>
                                                        </li>

                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                    </div> <!--end row-->
                </div>
            </div>
            <!--*******2*****-->

        </div>
    </div>
{% endblock %}

{% block privacy  %}
{% endblock %}

{% block scripts %}
    <script>
        function commentComplaint(complaint) {
            if($('#complaintcomment').val() != '')
            {
                $('#complaintcomment').prop('disabled', true);
                $.ajax({
                    url:'{{ (path('complaint_comment')) }}',
                    type: 'POST',
                    dataType: 'json',
                    data:{
                        'comment':$('#complaintcomment').val(),
                        'complaint':complaint
                    },
                    async: true,
                    success: function (data)
                    {
                        if(data == 'ERR')
                            alert('Please , try again')
                        else
                        {
                            //add comment
                            var output = '<li class="media"><a href="#" class="pull-left">'
                            if('{{ user.image }}' == null || '{{ user.image }}' == '')
                                image = 'default.png'; else image = '{{ user.image }}';
                            output += '<img src="{{ asset('images/profile/') }}'+image+'"  alt="" class="img-circle"></a><div class="media-body"><div class="names">'
                            output += '{{ user.firstname }}'.concat(' ').concat('{{ user.lastname }}').concat('</div>')
                            output += '<p>'.concat($('#complaintcomment').val()).concat('</p></div></li>')

                            $('#complaint_comments_list').prepend(output);
                            $('#complaintcomment').val('')

                        }

                        $('#complaintcomment').prop('disabled', false);
                    }
                });
            }
        }
    </script>
{% endblock %}