{% extends "UserBundle::userbase.html.twig" %}

{% block style %}
    <link href={{ asset('Userscripts/js/photos/ekko-lightbox.css') }} rel="stylesheet">
    <script src={{ asset('Userscripts/js/photos/ekko-lightbox.js') }}></script>
    <link rel="stylesheet" href={{ asset('Userscripts/css/newpost.css') }}>
    <link rel="stylesheet" href={{ asset('Userscripts/css/socialpost.css') }}>
{% endblock %}

{% block Title %}
    {% set view_group = app.session.get('view_group') %}
    {{ view_group.group.name }}
{% endblock %}

{% block pageContent %}
    {% set view_group = app.session.get('view_group') %}


    <div style="margin-top:80px">
        <div class="container bootstrap snippet">
            <div style="float: right;margin-top: 5px">
                <a ><button type="button" class="btn btn-success btn-sm"><i class="fa fa-comments"  title="Join the Group Chat"></i></button></a>
                <a ><button type="button" class="btn btn-sm" onclick="$('#configModal').modal('show')"><i class="fa fa-cog"></i></button></a>
            </div>
            <div class="panel profile-info">
                <form id="postform" data-parsley-validate class="form-horizontal form-label-left" enctype="multipart/form-data" method="post" action="{{ path('save_post',{'group': view_group.group.id } ) }}">
                    <textarea style="border:none" class="form-control input-lg p-text-area" rows="2" placeholder="What's in your mind today?" name="post_description" id="description" required></textarea>
                    <div id="cover">
                        <div class="gallery"></div>
                        <div id="add_photo"><i class="fa fa-plus" aria-hidden="true"></i></div>
                    </div>
                    <div id="post_line"></div>
                    <div id="up_area"> <!-- upload -->
                        <div style="display:inline-block;">
                            <div class="form-inline">
                                <img src="{{ asset('Userscripts/img/upimg.svg') }}" width="20px" height="20px" style="display:inline" onclick="document.getElementById('gallery-photo-add').click();">
                                <input type="file"  name="uploadimage[]"  id="gallery-photo-add" style="display:none" accept="image/*" multiple>
                                <h9 id="upload_title">Photo</h9>
                            </div>
                        </div>
                        <!--Video -->
                        <div style="display:inline-block;">
                            <div class="form-inline">
                                <img src="{{ asset('Userscripts/img//upvideo.svg') }}" id="video_prev" width="20px" height="20px" onclick="document.getElementById('post_video').click();">
                                <input type="file" id="post_video" name="post_video"  onchange="readVideoURL(this);"  accept="video/mp4" style="display:none;">
                                <h9 id="upload_Video_title">Video</h9>
                            </div>
                        </div>
                        <!--Video -->
                    </div><!--end upload -->

                    <button type="submit" class="btn btn-info" id="postpan" >Post</button>

                </form>
            </div>
            <!-- Posts -->
            {% if view_group.posts|length > 0 %}
                {% for item in view_group.posts %}
                    <div class="panel" style="margin-top: 2.5%;">
                        <div class="panel-body">
                            <!-- Image -->
                            <div class="fb-user-thumb" style="display:inline">
                                {% if item.owner.image is null %} {% set image = 'default.png' %} {% else %} {% set image = item.owner.image  %}{% endif %}
                                <a><img src="{{ asset('images/profile/') }}{{ image }}" class="img-circle" style="width: 70px;height: 70px;object-fit: cover;"></a>
                            </div>
                            {% if user.id == item.owner.id %}
                                <!--add remove post -->
                                <div style="display:inline;float:right">
                                    <!-- Single button -->
                                    <div class="btn-group ">
                                        <button style="    visibility: hidden;"type="button" class="btn btn-primary">Right dropup</button>
                                        <button type="button" style="background:white;border:0" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                            <i style="color:black" class="fa fa-ellipsis-h"></i>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-right">
                                            <li><a id="deletpostbtn" href="{{ path('delete_post',{'post': item.post.id }) }}">Delet</a></li>
                                        </ul>
                                    </div>
                                </div>
                            {% endif %}
                            <!--end delet post -->
                            <!-- Name / Boosted /Date / Adress -->
                            <div class="fb-user-details">
                                <h3><a>{{ item.owner.firstname }} {{ item.owner.lastname }}</a> {% if item.owner.companyName is not null %} <small> {{ item.owner.companyName }}</small> {% endif %}</h3>
                                <p> {{ item.post.creationDate }} {% if item.owner.adress is not null %} <small>in</small> {{ item.owner.adress }} {% endif %}</p>
                            </div>
                            <div class="clearfix"></div>

                            <!-- display post content -->
                            <p class="fb-user-status">
                                <div style="word-wrap:break-word">
                                    {{ item.post.content }}
                                </div>
                                <br>
                                <!-- images + video -->
                                <div class="parent" style="max-width: 650px;">
                                    {% if item.post.video is not null %}
                                        {% if item.images >0 %}
                                            {% if item.images|length == 1 %}<!-- 1 photo+video: -->
                                                <div style="max-width:600px">
                                                    <video  class="Vidoe_Player" controls  playsinline  controls qualitychange>
                                                        <source src="{{ asset('videos/') }}{{ item.post.video }}" type="video/mp4">
                                                        {{'Your browser does not support the video tag.'|trans}}
                                                    </video>
                                                </div>
                                                <div>
                                                    <a  href="{{ asset('images/post/') }}{{ item.images|first }}" data-max-width="600" data-toggle="lightbox" data-gallery="{{ item.post.id }}"> <img src="{{ asset('images/post/') }}{{ item.images|first }}" id="post_img" class="post-1img-video img-responsive"></a>
                                                </div>
                                            {% endif %}<!--end 1 photo+video: -->

                                            {% if item.images|length == 2 or item.images|length == 3   %}<!--end 2 or 3 photo+video -->
                                                <div style="max-width:600px">
                                                    <video  class="Vidoe_Player" controls  playsinline  controls qualitychange>
                                                        <source src="{{ asset('videos/') }}{{ item.post.video }}" type="video/mp4">
                                                        {{'Your browser does not support the video tag.'|trans}}
                                                    </video>
                                                </div>

                                                <div>
                                                    {% for img in item.images %}
                                                        <a  href="{{ asset('images/post/') }}{{ img }}" data-toggle="lightbox" data-gallery="{{ item.post.id }}"> <img src="{{ asset('images/post/') }}{{ img }}" id="post_img" {% if item.images|length == 2 %}class="img-responsive post-2img-video" {% else %}class="post-3img-video-fixed img-responsive"{% endif %}></a>
                                                    {% endfor %}
                                                </div>

                                            {% endif %}<!--end 2 or 3 photo+video -->

                                            {% if item.images|length > 3 %}<!--more than 3 photo+video: -->
                                                <div style="max-width:600px">
                                                    <video  class="Vidoe_Player" controls  playsinline  controls qualitychange>
                                                        <source src="{{ asset('videos/') }}{{ item.post.video }}" type="video/mp4">
                                                        {{'Your browser does not support the video tag.'|trans}}
                                                    </video>
                                                </div>

                                                <div>
                                                    {% for img in item.images[0:2]  %}
                                                        <a  href="{{ asset('images/post/') }}{{ img }}" data-toggle="lightbox"  data-gallery="{{ item.post.id }}"> <img src="{{ asset('images/post/') }}{{ img }}"  class="post-3img-video img-responsive"></a>
                                                    {% endfor %}

                                                    <a  href="{{ asset('images/post/') }}{{ item.images[2] }}" data-toggle="lightbox"  data-gallery="{{ item.post.id }}">
                                                        <div class="post-3imgvid-wrapblack">

                                                            <img src="{{ asset('images/post/') }}{{ item.images[2] }}"  class="post-3imgvid-blackimg img-responsive">

                                                            <div class="post-3imgvid-count">
                                                                +{{ item.images|length - 2 }}
                                                            </div>
                                                        </div>
                                                    </a>

                                                    <!-- elements not showing, use data-remote -->
                                                    {% for img in item.images[3:item.images|length] %}
                                                        <div data-toggle="lightbox" data-gallery="{{ item.post.id }}" data-remote="{{ asset('images/post/') }}{{ img }}" ></div>
                                                    {% endfor %}


                                                </div>

                                            {% endif %}<!--end more than 3 photo+video: -->

                                            {% if item.images|length == 0  %}
                                                <div style="max-width:600px">
                                                    <video  class="Vidoe_Player" controls  playsinline  controls qualitychange>
                                                        <source src="{{ asset('videos/') }}{{ item.post.video }}" type="video/mp4">
                                                        {{'Your browser does not support the video tag.'|trans}}
                                                    </video>
                                                </div>
                                            {% endif %}
                                        {% endif %}
                                    {% endif %}

                                    {% if item.post.video is null %}
                                        {% if item.images|length == 1  %}<!--1 photo -->
                                            <div>
                                                <a  href="{{ asset('images/post/') }}{{ item.images|first }}" data-max-width="1000" data-toggle="lightbox" data-gallery="{{ item.post.id }}"> <img src="{{ asset('images/post/') }}{{ item.images|first }}" id="post_img" class="post-1img img-responsive"></a>
                                            </div>
                                        {% endif %}<!--end 1 photo-->

                                        {% if item.images|length == 2 or item.images|length == 3   %}<!--2 or 3 photo -->
                                            <div>
                                                {% for img in item.images %}
                                                    <a  href="{{ asset('images/post/') }}{{ img }}" data-toggle="lightbox" data-gallery="{{ item.post.id }}"> <img src="{{ asset('images/post/') }}{{ img }}" id="post_img" {% if item.images|length == 2 %}class="img-responsive post-2-img" {% else %}class="post-3-img img-responsive"{% endif %}></a>
                                                {% endfor %}
                                            </div>
                                        {% endif %}<!--end 2 or 3 photo -->

                                        {% if item.images|length > 3   %} <!--more than 3 photo -->
                                            <div>
                                                {% for img in item.images[0:2]  %}
                                                    <a  href="{{ asset('images/post/') }}{{ img }}" data-toggle="lightbox"  data-gallery="{{ item.post.id }}"> <img src="{{ asset('images/post/') }}{{ img }}"  class="post-3img-video img-responsive"></a>
                                                {% endfor %}

                                                <a  href="{{ asset('images/post/') }}{{ item.images[2] }}" data-toggle="lightbox"  data-gallery="{{ item.post.id }}">
                                                    <div class="post-3imgvid-wrapblack">

                                                        <img src="{{ asset('images/post/') }}{{ item.images[2] }}"  class="post-3imgvid-blackimg img-responsive">

                                                        <div class="post-3imgvid-count">
                                                            +{{ item.images|length - 2 }}
                                                        </div>
                                                    </div>
                                                </a>
                                                <!-- elements not showing, use data-remote -->
                                                {% for img in item.images[3:item.images|length] %}
                                                    <div data-toggle="lightbox" data-gallery="{{ item.post.id }}" data-remote="{{ asset('images/post/') }}{{ img }}" ></div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}<!--more than 3 photo -->
                                    {% endif %}


                                </div>
                            </p>

                            <!-- actions -->
                            <div class="fb-status-container fb-border">
                                <div class="fb-time-action">
                                    {% if item.like_type == 'like' %}
                                        <a href="#like" id="like{{ item.post.id }}" onclick="like({{ item.post.id }},item.likes)" title="Like this" style="background-color: transparent !important;"><i class="fa fa-thumbs-o-up" ></i></a>
                                        <a href="#dislike" id="dislike{{ item.post.id }}" onclick="dislike({{ item.post.id }},item.likes)" title="Dislike this" style="background-color: transparent !important; display: none;" ><i class="fa fa-thumbs-up" ></i></a>
                                    {% else %}
                                        <a href="#dislike" id="dislike{{ item.post.id }}" title="Dislike this" onclick="dislike({{ item.post.id }},item.likes)" style="background-color: transparent !important;"><i class="fa fa-thumbs-up" ></i></a>
                                        <a href="#like" id="like{{ item.post.id }}" title="Like this" onclick="like({{ item.post.id }},item.likes)"  style="background-color: transparent !important; display: none;"><i class="fa fa-thumbs-o-up" ></i></a>
                                    {% endif %}
                                    <span></span>
                                    {% if view_group.group.privacy == 'public' %}
                                        <div class="btn-group">
                                            <button type="button" style="border:0" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <i class="fa fa-share fa-lg"></i>
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li><a href="#share_post" onclick="sharePost({{ item.post.id }})" title="Send this to friend or post it on your time line">{{'on your timeline'|trans}}</a></li>
                                                <!--<li role="separator" class="divider"></li>
                                                <li><a href="#" class="share_facebook" data-url="https://www.youtube.com/watch?v=mAJeK283j0I"><i class="fa fa-facebook"></i></a></li>
                                                 <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                                                 <li><a href="#"><i class="fa fa-linkedin"></i></a></li>-->
                                            </ul>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <!-- count likes and comments -->
                            <div class="fb-status-container fb-border fb-gray-bg">
                                <div class="fb-time-action like-info">
                                    <!-- current user  (and) others-->
                                    {% if item.like_type == 'dislike' %}
                                        <div id="youitem{{ item.post.id }}" style="display: inline;"><b style="display: inline;">  {{'You'|trans}}</b> {% if item.likes == 0 %}<small style="display: inline;">{{'like this'|trans}}</small>{% endif %} </div>
                                    {% else %}
                                        <div id="youitem{{ item.post.id }}" style="display: none;"><b style="display: inline;"> {{'You'|trans}}</b> {% if item.likes == 0 %}<small style="display: inline;">{{' like this'|trans}}</small>{% endif %} </div>
                                    {% endif %}
                                </div>

                                <ul class="fb-comments" id="commentslist{{ item.post.id }}" style="padding: 0">
                                    {% set comments = item.comments %}

                                    {% if comments|length > 0 %}
                                        {% for comment in comments[0:3] %}
                                            <li  id ="comment_{{ comment.id }}">
                                                <!-- remove comment -->
                                                {% if comment.user.id == user.id %}
                                                    <div style="display:inline;float:right">
                                                        <div class="btn-group ">
                                                            <button style="    visibility: hidden;"type="button" class="btn btn-primary">Right dropup</button>
                                                            <button type="button" style="background:#f6f6f6;border:0" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                                                <i style="color:black" class="fa fa-ellipsis-h"></i>
                                                            </button>
                                                            <ul class="dropdown-menu dropdown-menu-right">
                                                                <li><a onclick="clickdeletcmnt()">{{'Delet'|trans}}</a></li>
                                                                <li style="display:none"><a id="deletcmntbtn" onclick="DeleteComment({{ comment.id }})">Delet</a></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                <!--end remove comment -->
                                                <a  class="cmt-thumb">
                                                    {% if comment.user.image is null %}{% set commentow_image = 'default.png' %}{% else %}{% set commentow_image = comment.user.image %} {% endif %}
                                                    <img src="{{ asset('images/profile/') }}{{ commentow_image }}" class="img-circle" style="width: 50px;height: 50px;object-fit: cover;">
                                                </a>
                                                <div class="cmt-details">
                                                    <div><a >{{ comment.user.firstname }} {{ comment.user.lastname }}</a></div>
                                                    <div style="word-wrap:break-word"><span> {{ comment.comment }} </span></div>
                                                </div>
                                            </li>
                                        {% endfor %}
                                        {% if comments|length >3 %}
                                            <a id="morelink{{ item.post.id }}" href="#more_comments" onclick="morecomments({{ item.post.id }});return false;">{{'more comments'|trans}}</a>
                                            <div id="more{{ item.post.id }}" style="display: none;">
                                                {% for comment in comments[4:comments|length] %}
                                                    <li  id ="comment_{{ comment.id }}">
                                                        <!-- remove comment -->
                                                        {% if comment.user.id == user.id %}
                                                            <div style="display:inline;float:right">
                                                                <div class="btn-group ">
                                                                    <button style="    visibility: hidden;"type="button" class="btn btn-primary">Right dropup</button>
                                                                    <button type="button" style="background:#f6f6f6;border:0" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                                                        <i style="color:black" class="fa fa-ellipsis-h"></i>
                                                                    </button>
                                                                    <ul class="dropdown-menu dropdown-menu-right">
                                                                        <li><a onclick="clickdeletcmnt()">{{'Delet'|trans}}</a></li>
                                                                        <li style="display:none"><a id="deletcmntbtn" onclick="DeleteComment({{ comment.id }})">Delet</a></li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        {% endif %}
                                                        <!--end remove comment -->
                                                        <a  class="cmt-thumb">
                                                            {% if comment.user.image is null %}{% set commentow_image = 'default.png' %}{% else %}{% set commentow_image = comment.user.image %} {% endif %}
                                                            <img src="{{ asset('images/profile/') }}{{ commentow_image }}" class="img-circle" style="width: 50px;height: 50px;object-fit: cover;">
                                                        </a>
                                                        <div class="cmt-details">
                                                            <div><a >{{ comment.user.firstname }} {{ comment.user.lastname }}</a></div>
                                                            <div style="word-wrap:break-word"><span> {{ comment.comment }} </span></div>
                                                        </div>
                                                    </li>
                                                {% endfor %}
                                                <div><a href="#less_comments" onclick="lesscomments({{ item.post.id }});return false;">{{'less comments'|trans}}</a></div>
                                            </div>
                                        {% endif %}
                                    {% endif %}

                                    <!-- comment form -->
                                    <li>
                                        <div class="input-group">
                                            <spana  class="input-group-btn">
                                                <img src="{{ asset('images/profile/') }}{{ currentimage }}" alt="{{ user.firstname }}{{ user.lastname }}" class="img-circle" style="width: 45px;height: 45px;object-fit: cover">
                                            </spana>
                                            <textarea class="form-control" placeholder="{{'Write a comment...'|trans}}" name="" id="contentComment{{ item.post.id }}" style="resize:none;border-radius: 30px;margin-left: 5px;"></textarea>
                                        </div>
                                        <button type="button" class="btn btn-primary" style="float: right;border-radius: 30px" onclick="postComment({{ item.post.id }})">{{'Comment'|trans}}</button>
                                        <br><br>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <h3>Sorry there's no posts to display now !</h3>
            {% endif %}
        </div>
    </div>

    <!-- Config form -->
    <div id="configModal" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">{{ view_group.group.name }} </h4>
                    </div>
                    <div class="modal-body">
                        <div class="" role="tabpanel" data-example-id="togglable-tabs">
                            <ul id="myTab" class="nav nav-tabs bar_tabs" role="tablist">
                                <li role="presentation" class="active"><a href="#tab_content1" id="home-tab" role="tab" data-toggle="tab" aria-expanded="true">About</a>
                                </li>
                                <li role="presentation" class=""><a href="#tab_content2" role="tab" id="profile-tab" data-toggle="tab" aria-expanded="false">Members ({{ view_group.members|length }})</a>
                                </li>
                                {% if view_group.group.user.id == user.id %}
                                    <li role="presentation" class=""><a href="#tab_content3" role="tab" id="config-tab" data-toggle="tab" aria-expanded="false">Configuration</a>
                                    </li>
                                {% endif %}
                            </ul>
                            <div id="myTabContent" class="tab-content">
                                <div role="tabpanel" class="tab-pane fade active in" id="tab_content1" aria-labelledby="home-tab">
                                    <ul class="list-unstyled timeline">
                                        <li>
                                            <div class="block">
                                                <div class="tags">
                                                    <a href="" class="tag">
                                                        <span>Created By</span>
                                                    </a>
                                                </div>
                                                <div class="block_content">
                                                    <div class="byline">
                                                        <span>on  {{ view_group.group.creationDate }} </span> by {{ view_group.group.user.lastname }} {{ view_group.group.user.firstname }} <a> <!--(<strong>ACE MEMBER</strong>)--></a>
                                                    </div>
                                                    </p>
                                                </div>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="block">
                                                <div class="tags">
                                                    <a href="" class="tag">
                                                        <span>Description</span>
                                                    </a>
                                                </div>
                                                <div class="block_content">
                                                    <div class="byline">
                                                        <p>
                                                            {{ view_group.group.description }}
                                                        </p>
                                                    </div>
                                                    </p>
                                                </div>
                                            </div>
                                        </li>

                                    </ul>

                                </div>
                                <div role="tabpanel" class="tab-pane fade" id="tab_content2" aria-labelledby="profile-tab">

                                    <table class="table table-hover" id="memberslist">
                                        <thead>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                            {% for item in  view_group.members%}
                                                <tr id="retirer{{ item.user.id  }}">
                                                    <td>{{ item.user.firstname }} {{ item.user.lastname }}</td>
                                                    <td>
                                                        {% if view_group.group.user.id == user.id %}
                                                            <button type="button" class="btn btn-round btn-danger btn-xs remove" title="remove from group" onclick="removeMember({{ view_group.group.id }},{{ item.user.id }})"><i class="fa fa-minus"></i></button>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <div role="tabpanel" class="tab-pane fade" id="tab_content3" aria-labelledby="config-tab">
                                    <form action="{{ path('configuration',{'group': view_group.group.id }) }}" method="post" enctype="multipart/form-data">
                                        <div class="form-group">
                                            <input type="file" name="image"  class="form-control">
                                        </div>
                                        <div class="form-group">
                                            <input type="text" name="name"  placeholder="Change name" value="{{ view_group.group.name }}" class="form-control" required>
                                        </div>
                                        <div class="form-group">
                                            <textarea  placeholder="Update Descreption" name="description"  class="form-control" required>{{ view_group.group.description }}</textarea>
                                        </div>
                                        <div class="form-group pull-right">
                                            <button type="submit" class="btn btn-success" ><i class="fa fa-check"></i></button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>

            </div>
        </div>
{% endblock %}


{% block scripts %}
    <script>
        function deletpostfunc(){
            alert('ff');
            swal({
            title: "Are you sure?",
            text: "Are you sure that you want to exit delet this post ?",
            icon: "warning",
            buttons: ["NO", "YES !"],
            dangerMode: true,
            })
            .then(willDelete => {
                if (willDelete) {
                    document.getElementById("deletpostbtn").click();
                }
            });
        }

        function removeMember (group,user)
        {
        swal({
            title: "Are you sure?",
            text: "Are you sure that you want to remove this member ?",
            icon: "warning",
            buttons: ["NO", "YES !"],
            dangerMode: true,
            })
            .then(willDelete => {
                if (willDelete) {
                    //**********
                    $('#retirer'.concat(user)).remove();
                    $.ajax({
                        url:'{{ (path('remove_member')) }}',
                        type: 'POST',
                        dataType: 'json',
                        data:
                            {
                                'group':group,
                                'user':user
                            },
                        async: true
                    });
                    //******
                }
        });
            
            
        }
    </script>

    <!-- media -->
    <script>


        $(function() {
            // Multiple images preview in browser
            var imagesPreview = function(input, placeToInsertImagePreview) {
                $("#cover").css({});
                if (input.files) {
                    var filesAmount = input.files.length;

                    for (i = 0; i < filesAmount; i++) {
                        var reader = new FileReader();

                        reader.onload = function(event) {
                            $($.parseHTML('<img>')).attr({src:event.target.result,style:"width:50px;height:50px;object-fit:cover;border-radius:5px;margin:5px; display: inline-block"}).appendTo(placeToInsertImagePreview);
                        }

                        reader.readAsDataURL(input.files[i]);
                    }
                }

            };

            $('#gallery-photo-add').on('change', function() {
                imagesPreview(this, 'div.gallery');
            });
        });


        // Video
        var video = null;
        function readVideoURL(input) {
            if (input.files && input.files[0]) {

                var reader = new FileReader();
                var filename = $('#post_video').val().split('\\').pop();

                reader.onload = function (e) {
                    $("#upload_Video_title").text(filename)
                };


                reader.readAsDataURL(input.files[0]);
                //
                video = input.files[0]

            }
        }
    </script>
    <script src="{{ asset('Userscripts/js/video/plyr.js') }}"></script>
    <script>
        //const player = new Plyr('.Vidoe_Player');
        const players = Array.from(document.querySelectorAll('.Vidoe_Player')).map(p => new Plyr(p));

    </script>

    <script src="{{ asset('Userscripts/js/photos/ekko-lightbox.js') }}"></script>
    <script>
        $(document).on('click', '[data-toggle="lightbox"]', function(event) {
            event.preventDefault();
            $(this).ekkoLightbox();
        });
    </script>
    <script>
        $(window).on("navigate", function (event, data) {
            var direction = data.state.direction;
            if (direction == 'back') {
                alert('back')
            }
        });
    </script>

    <!-- Like && Dislike -->
    <script>
        function like(post,countLikes)
        {
            $('#like'.concat(post)).hide()
            $('#dislike'.concat(post)).show()
            //
            $('#youitem'.concat(post)).show()
            $('#youitem'.concat(post)).css('display','inline')
            //
            if(countLikes > 1)
            {
                $('#anditem'.concat(post)).show()
                $('#anditem'.concat(post)).css('display','inline')
            }
            $.ajax({
                url: '{{ (path('group_post_like')) }}',
                type: 'POST',
                dataType: 'json',
                data:
                    {
                        'post':post
                    },
                async: true,
                success: function (data)
                {
                    if(data == 'ERR')
                    {
                        swal('{{"sorry you cannot like the post , you can try another time"|trans}}');
                        $('#dislike'.concat(post)).hide()
                        $('#like'.concat(post)).show()
                        //
                        $('#youitem'.concat(post)).hide()
                        $('#youitem'.concat(post)).css('display','none')
                    }
                }
            });
        }

        function dislike(post,countLikes)
        {
            $('#dislike'.concat(post)).hide()
            $('#like'.concat(post)).show()
            //
            $('#youitem'.concat(post)).hide()
            $('#youitem'.concat(post)).css('display','none')
            //
            if(countLikes>1)
                $('#anditem'.concat(post)).hide()
            $.ajax({
                url: '{{ (path('group_post_dislike')) }}',
                type: 'POST',
                dataType: 'json',
                data:
                    {
                        'post':post
                    },
                async: true,
                success: function (data)
                {
                    if(data == 'ERR')
                    {
                        swal('{{"sorry you cannot like the post , you can try another time"|trans}}');
                        $('#like'.concat(post)).hide()
                        $('#dislike'.concat(post)).show()
                        //
                        $('#youitem'.concat(post)).show()
                        $('#youitem'.concat(post)).css('display','inline')
                    }
                }
            });
        }
    </script>

    <!-- Share -->
    <script>
        function sharePost(post)
        {
            swal('{{"Post shared on your profile !"|trans}}');
            $.ajax({
                url: '{{ (path('group_post_share')) }}',
                type: 'POST',
                dataType: 'json',
                data:
                    {
                        'post':post
                    },
                async: true
            });
        }
    </script>

    <!-- Comment -->
    <script>
        function postComment(post)
        {
            if($('#contentComment'.concat(post)).val() != '')
            {
                $('#contentComment'.concat(post)).prop('disabled', true);
                $.ajax({
                    url: '{{ (path('group_post_comment')) }}',
                    type: 'POST',
                    dataType: 'json',
                    data:
                        {
                            'post':post,
                            'comment':$('#contentComment'.concat(post)).val()
                        },
                    async: true,
                    success: function (data)
                    {
                        if(data > 0)
                        {
                            // output
                            var output = '<li id="comment_'+data+'">';
                            output += '<div style="display:inline;float:right"><div class="btn-group ">';
                            output += '<button style="visibility: hidden;"type="button" class="btn btn-primary">Right dropup</button>';
                            output += '<button type="button" style="background:#f6f6f6;border:0" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><i style="color:black" class="fa fa-ellipsis-h"></i></button><ul class="dropdown-menu dropdown-menu-right">'
                            output += '<li><a onclick="clickdeletcmnt()">{{"Delet"|trans}}</a></li>'
                            output += '<li style="display:none"><a id="deletcmntbtn" onclick="DeleteComment('+data+')">Delet</a></li>'
                            output += '<a  class="cmt-thumb"></button>'
                            output += '</ul></div></div>'
                            var image = '{{ currentimage }}'
                            output += '<img src="{{ asset('images/profile/') }}'+image+'" class="img-circle" style="width: 50px;height: 50px;object-fit: cover;margin-right: 20px;"></a>'
                            output += '<div class="cmt-details">'
                            var fullname = '{{ user.firstname }}'.concat(' ').concat('{{ user.lastname }}')
                            output += '<div><a href="#">'+fullname+ '</a></div>'
                            output += '<div><span> '+$('#contentComment'.concat(post)).val()+' </span><div>'
                            output += '</div></li>'; //
                            $('#commentslist'.concat(post)).prepend(output);
                            $('#contentComment'.concat(post)).val('')
                        }
                        else
                            swal('{{"Soryy you cannot comment this post now , please try in another time"|trans}}');



                        $('#contentComment'.concat(post)).prop('disabled', false);
                    }
                });
            }
            else
                swal('{{"Please , set a comment"|trans}}');
        }
    </script>

    <!--Display comments -->
    <script>
        function morecomments(post)
        {
            $('#morelink'.concat(post)).hide()
            $('#more'.concat(post)).show()
        }

        function lesscomments(post)
        {
            $('#morelink'.concat(post)).show()
            $('#more'.concat(post)).hide()
        }
    </script>

    <!--Delete comment -->
    <script>
        function DeleteComment(comment)
        {
            // confirmation
            $('#comment_'.concat(comment)).remove();
            //
            $.ajax({
                url: '{{ (path('delete_comment')) }}',
                type: 'POST',
                dataType: 'json',
                data:
                    {
                        'comment':comment
                    },
                async: true
            });
        }
    </script>
{% endblock %}



{% block privacy  %}
{% endblock %}